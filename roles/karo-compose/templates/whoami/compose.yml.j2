# SPDX-FileCopyrightText: 2025 hazzuk
#
# SPDX-License-Identifier: AGPL-3.0-only

---
name: whoami
services:

  whoami:
    # https://github.com/traefik/whoami
    # https://hub.docker.com/r/traefik/whoami
    image: {{ karo_compose_whoami_image }}:{{ karo_compose_whoami_version }}
    container_name: whoami
    restart: {{ karo_compose_restart_policy }}
    networks:
      - frontend
    labels:
      - traefik.enable=true
      - traefik.http.routers.whoami.rule=Host(`{{ karo_compose_whoami_domain }}`)
      # - traefik.http.routers.whoami.tls=true
      # - traefik.http.routers.whoami.tls.certresolver=cloudflare
      # - traefik.http.routers.dashboard.entrypoints=websecure
      - traefik.http.services.whoami.loadbalancer.server.port=80
      # forward auth
      - traefik.http.routers.whoami.middlewares=tinyauth
      - tinyauth.apps.whoami.config.domain={{ karo_compose_whoami_domain }}
      - tinyauth.apps.whoami.oauth.groups={{ karo_compose_oidc_admin_group }}
      - tinyauth.apps.whoami.path.allow=^\/api

networks:
  frontend:
    external: true
